<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Node.js</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/materialize.min.css" media="screen,projection">
    <link rel="stylesheet" href="css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
<div class="container">
    <h1>Устройство базы данных. Документы</h1>
    <p>Всю модель устройства базы данных в MongoDB можно представить следующим образом:</p>
    <img src="images/mongo/day_3_1.png" alt="" class="responsive-img">
    <p>Если в реляционных бд содержимое составляют таблицы, то в mongodb база данных состоит из коллекций.</p>

    <p>Каждая коллекция имеет свое уникальное имя - произвольный идентификатор, состоящий из не более чем 128 различных алфавитно-цифровых символов и знака подчеркивания.</p>

    <p>В отличие от реляционных баз данных MongoDB не использует табличное устройство с четко заданным количеством столбцов и типов данных. MongoDB является документо-ориентированной системой, в которой центральным понятием является документ.</p>

    <p>Документ можно представить как объект, хранящий некоторую информацию. В некотором смысле он подобен строкам в реляционных субд, где строки хранят информацию об отдельном элементе. Например, типичный документ:</p>
    <pre class="code">
        {
    "name": "Bill",
    "surname": "Gates",
    "age": "48",
    "company": {
        "name" : "microsoft",
        "year" : "1974",
        "price" : "300000"
        }
}
    </pre>
    <p>Документ представляет набор пар ключ-значение. Например, в выражении "name": "Bill" name представляет ключ, а Bill - значение.</p>

    <p>Ключи представляют строки. Значения же могут различаться по типу данных. В данном случае у нас почти все значения также представляют строковый тип, и лишь один ключ (company) ссылается на отдельный объект. Всего имеется следующие типы значений:</p>
    <ul class="browser-default">
        <li>String: строковый тип данных, как в приведенном выше примере (для строк используется кодировка UTF-8)</li>
        <li>Array (массив): тип данных для хранения массивов элементов</li>
        <li>Binary data (двоичные данные): тип для хранения данных в бинарном формате</li>
        <li>Boolean: булевый тип данных, хранящий логические значения TRUE или FALSE, например, {"married": FALSE}</li>
        <li>Date: хранит дату в формате времени Unix</li>
        <li> Double: числовой тип данных для хранения чисел с плавающей точкой</li>
        <li>Integer: используется для хранения целочисленных значений, например, {"age": 29}</li>
        <li>JavaScript: тип данных для хранения кода javascript</li>
        <li>Min key/Max key: используются для сравнения значений с наименьшим/наибольшим элементов BSON</li>
        <li>Null: тип данных для хранения значения Null</li>
        <li>Object: строковый тип данных, как в приведенном выше примере</li>
        <li>ObjectID: тип данных для хранения id документа</li>
        <li> Regular expression: применяется для хранения регулярных выражений</li>
        <li> Symbol: тип данных, идентичный строковому. Используется преимущественно для тех языков, в которых есть специальные символы.</li>
        <li>Timestamp: применяется для хранения времени</li>
    </ul>
    <p>В отличие от строк документы могут содержать разнородную информацию. Так, рядом с документом, описанным выше, в одной коллекции может находиться другой объект, например:</p>
    <pre class="code">
        {
    "name": "Tom",
    "birthday": "1985.06.28",
    "place" : "Vashington",
    "languages" :[
        "english",
        "german",
        "spanish"
    ]
}
    </pre>
    <p>Казалось бы разные объекты за исключением отдельных свойств, но все они могут находиться в одной коллекции.</p>

    <p>Еще пара важных замечаний: в MongoDB запросы обладают регистрозависимостью и строгой типизацией. То есть следующие два документа не будут идентичны:</p>
    <pre class="code">
        {"age" : "28"}
{"age" : 28}
    </pre>
    <p>Если в первом случае для ключа age определена в качестве значения строка, то во втором случае значением является число.</p>
    <h3>Идентификатор документа</h3>
    <p>Для каждого документа в MongoDB определен уникальный идентификатор, который называется _id. При добавлении документа в коллекцию данный идентификатор создается автоматически. Однако разработчик может сам явным образом задать идентификатор, а не полагаться на автоматически генерируемые, указав соответствующий ключ и его значение в документе.</p>

    <p>Данное поле должно иметь уникальное значение в рамках коллекции. И если мы попробуем добавить в коллекцию два документа с одинаковым идентификатором, то добавится только один из них, а при добавлении второго мы получим ошибку.</p>

    <p>Если идентификатор не задан явно, то MongoDB создает специальное бинарное значение размером 12 байт. Это значение состоит из нескольких сегментов: значение типа timestamp размером 4 байта, идентификатор машины из 3 байт, идентификатор процесса из 2 байт и счетчик из 3 байт. Таким образом, первые 9 байт гарантируют уникальность среди других машин, на которых могут быть реплики базы данных. А следующие 3 байта гарантируют уникальность в течение одной секунды для одного процесса. Такая модель построения идентификатора гарантирует с высокой долей вероятности, что он будет иметь уникальное значение, ведь она позволяет создавать до 16 777 216 уникальных объектов ObjectId в секунду для одного процесса.</p>
    <h2>Получение информации о базе данных</h2>
    <table class="striped responsive-table">
        <tr>
            <td>use</td>
            <td>использовать или создать базу данных</td>
        </tr>
        <tr>
            <td>show dbs</td>
            <td>показать базы данных</td>
        <tr>
            <td>use имя_базы</td>
            <td>использовать базу (переключится на базу)</td>
        </tr>
        <tr>
            <td>db</td>
            <td>имя текущий базы данных</td>
        </tr>
        <tr>
            <td>db.stats()</td>
            <td>статистика текущей базы данных</td>
        </tr>
        <tr>
            <td>db.имя_коллекции.stats()</td>
            <td>статистика по имя_коллекции</td>
        </tr>
        <tr>
            <td>db.имя_коллекции.find()</td>
            <td>вывод коллекции в консоль</td>
        </tr>
        <tr>
            <td>db.имя_коллекции.insertOne({"name": "Tom"})</td>
            <td>Добавление документа в коллекцию</td>
        </tr>
        <tr>
            <td>db.users.insertMany([{"name": "Bob",},{"name": "Alice"}])</td>
            <td>Добавление нескольких документов в коллекцию</td>
        </tr>
        <tr>
            <td>db.users.insert({"name": "Tom"})</td>
            <td>Универсальный способ добавления документов</td>
        </tr>
    </table>
</div>


<!--Import jQuery before materialize.js-->
<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="js/materialize.min.js"></script>
</body>
</html>